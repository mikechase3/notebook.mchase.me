# Chapter 06: Malicious Software

## 6.1: Types of Malicious Software (Malware)

### Classifications

Malware is classified into a couple of broad categories.

1. How it spreads/propagates
2. The actions or payloads it performs when the target is reached.
3. Those needing a host program (viruses & parasitic code)
4. Those that are independent, self-contained programs like worms, trojans, and bots.
5. Malware that doesn't replicate (trojans and spam emails)
6. Malware that doesn't replicate (like viruses and worms).

### Propagation Mechanisms

1. **Injection** of existing content by viruses spead to other systems
2. **Exploit** of software vulnerabilities by worms or drive-by-downloads
3. **Social Engineering**

### **Payload Actions**

Payload actions are performed by malware once it reaches a target.

* Corruption of system/data files
* Theft of service/make the system a zombie agent of an attack as part of the botnet.
* Theft of information from the system like keylogging.
* Stealthing/hiding its presence on the system.

### Terminology

![Source: Brown and Stallings. Security Principles and Practices.](<../../.gitbook/assets/image (558).png>)

![](<../../.gitbook/assets/image (554).png>)

### Attack Kits

* Initially the development and deployment of malware required considerable technical skills by software.
  * The development of virus-creation toolkits in the early 1990s and then more general attack kits in the 200s greatly assisted in the development/deployment of malware.
* Toolkits are often known as 'crimeware'
  * They include a variety of propagation mechanisms and payload modules that even novices can deploy
  * Variants that can be generated by attackers using these toolkits creates a significant problem for those defending systems against them.

#### Widely Used Toolkits

* Zeus
* Blackhole
* Sakura
* Phoenix

### Attack Sources

There are a lot of different reasons why people attack systems.

* Politically motivated attackers
* Criminals
* Organized Crime
* Organizations that sell their services
* Politically motivated

## 6.2: Advanced Persistent Threats (APTs)

### Definition

* Well resourced, persistent application of a wide variety of intrusion technologies and malware to selected targets (usually business/political).
* Typically attributed to state-sponsored organizations and criminal enterprises.
* They differ from other types of attack by their careful target selection and stealthy intrusion efforts over extended periods.
* **Examples:** High-profile attacks include Aurora, RSA, APT1, and Stuxnet.

### APT Characteristics

![Brown and Stallings](<../../.gitbook/assets/image (560).png>)

### APT Attacks

* **AIM**: Disrupt infrastructure and make it look unnoticeable.
* **Techniques Used**: Social engineering, spear-phishing email, drive-by-downloads from compressed websites likely to be visited by personnel in the target organization.
* **Intent**: Infect the target with sophisticated malware with multiple propagation mechanisms/payloads.

## 6.3: Viruses

Viruses goes through its propagation and tries to spread to any number of other programs it setup its propagation method to.

### Viruses Components

| Term                | Description                                                           |
| ------------------- | --------------------------------------------------------------------- |
| Infection Mechanism | How it spreads                                                        |
| Trigger             | Event that determines how it gets activated (are we on a centrifuge?) |
| Payload             | What the virus actually does (ie slow centrifuge)                     |

### Virus Phases

| Type              | Description                                                                                 |
| ----------------- | ------------------------------------------------------------------------------------------- |
| Dormant Phase     | It's there, but it's waiting for the triggering conditions to be true before its activated. |
| Triggering Phase  | The virus is activated in some way that the virus is able to observe it.                    |
| Propagation Phase | The virus will copy itself.                                                                 |
| Execution         | The function is executed.                                                                   |

### Virus Structure

![Source: Brown Stallings.](<../../.gitbook/assets/image (557).png>)

#### More on Compression Virus

One of the mechanisms anti-virus does is check the file size of executables. If the executable's size is increased, it's very easy to observe and stop. Therefore, prepending the simple virus will make that executable be caught.

A compression virus inserts itself such that the virus size doesn't change.

### Virus Classifications

![](<../../.gitbook/assets/image (553).png>)

![](<../../.gitbook/assets/image (556).png>)

![](<../../.gitbook/assets/image (555).png>)

### Macros and Scripting

![](<../../.gitbook/assets/image (559).png>)

## 6.4: Worms

![](<../../.gitbook/assets/image (561).png>)

### Worm Target Discovery: Scanning Strategies

Every worm does some sort-of scanning. When you ping a particular port, if there is a service available on that port, it is going to respond in some manner or fashion. The software that services hat port might change depending on the version or who wrote that software. For example, TCP software adheres to that standard, but they have slightly different versions of TCP. By saying it's running this company's version of TCP on this versions of Windows, it can tell that there's an exploit for that.

* **Random**: a very noisy attack which will generate high volumes of internet traffic.&#x20;
* **Hit-List**: You know where you're trying to go. You have a list of particular machines you're interested in or know that you have an exploit for this. Once a machine is affected, it is assigned a portion of that list to work on. It results in a short scanning period and is a lot more efficient.
* **Topological:** This uses information on the affected machine to decide where it's going to attack next.
* **Local Subnet**: You have this one subnet where you trust everyone by default. Since everyone is trusted within this subnet, I'm going to start looking for machines that are already in this subnet.

### Worm Propagation Model

![From "Computer Security Principles and Practices"](<../../.gitbook/assets/image (577).png>)

### The Morris Worm (p.219)

* Robert Morris wrote it in 1988 and was designed to work on Linux systems.
* Attempted to crack the local password file on one system and use that password on other systems.
* After it found the password, it would use the `finger` command to see if another user exists on a different machine and login.
* Once it got onto another machine, 1 out of 7 times, it would replicate even if it was already on the system which caused Morris to lose control of the propagation.
* Successful attacks achieved communication with the operating system command interpreter.
* He was convicted of violating _Computer Fraud and Abuse Act_.

### Recent Worms

![Source: Rusty Baldwin's Slides](<../../.gitbook/assets/image (578).png>)

* **Miria**: Interesting because it specifically targeted unsecured IoT devices. 600K infected devices induced a DDoS attack of 901 Gbps. A typical DDosS attack was 10-20Gbps.

### Worm Tech (p.222)

* **Metamorphic:** It's going to change itself slightly to avoid detection
* **Polymorphic:** Will change completely.
* **Ultrafast spreading:** it'll be slow so it's mostly undetected.
* Multiplatform
* Multiexploit

### Mobile Code (p.222)

These aren't mobile phones

* They can be shipped unchanged to a variety of platforms.
* These are installed and not every computer had the right drivers. So websites would send up some box and say _in order to watch this, you need to download this driver_ which was sometimes a virus.
* Java applets, ActiveX (horrible in regard to security), JavaScript, and VBScript (visual basic).

### Mobile Phone Worms

* The target is the smartphone.

### Drive By Downloads (223)

* You download a virus just by visiting a page without even having to do anything.
* **Fast-Flux Techniques**: How often the server its directing you changes its IP address so there's not a static address someone can go to and try to block it. But - this malicious code knows how to detect its current IP address.
* **Exploits:** Commercial exploit packages in the OS, browser, Java, PDF readers, media players, and other plugins.
* **Infection:** downloads payloads that will steal/extort money.
* **Execution:** Malware calls home with sensitive data.

### Clickjacking (224)

* You think you're clicking on a particular button, but the malicious software has somehow obscured the button you think you're clicking and inserts its own button that takes yo to a place to download malicious software.
* You can be typing your information into an invisible frame.

## 6.5: Social Engineering

* Tricking users to assist in the compromise of their own systems.
* **Spam:** unsolicited bulk email, significant carrier of malware, used for phishing attacks.
* **Trojan Horse:** Idk.
* **Mobile Phone Trojans:**&#x20;

## 6.6: Payload System Corruption (227)

* **Chernobyl Virus**: First seen in 1992 which infects executable files and corrupts the entire file system when a trigger date is reached.
* **Kelz**: On the trigger date, it caused the files on the hard drive to become empty; mass mailing worm infecting Windows 95 systems to XP systems.
* **Ransomware**: Encrypts the user's data and demands payment in order to access the key needed to recover the information.
  * PC Cyborg Trojan (1989)
  * Gpcode Trojan (2006)

## 6.8: Payload (231)

* Takes over another internet attached computer and uses that computer to launch or manage attacks.
* **Botnet**: a collection of bots capable of acting in a coordinated manner.

### Remote Control Facility (RCF)

* RCF is a means of implementing the remote control facility&#x20;
* It issues all the commands for the bots.

### Keylogger

* Steals your keystrokes.

### Spyware

* Spies on you.

### Phishing

* **Spear-Phishing**: is where recipients are carefully researched by the attacker.
* They are only sending messages to you.&#x20;

## 6.9: Payloads, Stealthing, Backdoors, Rootkits (233).

{% hint style="warning" %}
Incomplete
{% endhint %}

### Rootkits

* Sets of hidden programs installed on a system to maintain covert access to that system.
* It gives the attacker administrative privileges.

#### Characteristics

1. **Persistent**:&#x20;
2. **Memory Based**:&#x20;
3. **User Mode**:&#x20;
4. **Kernel Mode**: At a super high level.
5. **Virtual Machine Based**: Some root kits can break out of virtual machines.
6. **External Mode**: Basically used to exfiltrate data with respect to their operation.

### System Call: Table Modification by Rootkit

{% hint style="warning" %}
Dr. Baldwin - I hear the words coming out of you mouth, but I don't understand :(
{% endhint %}

This is an attack where you change the contents of memory and update something in the system call table.



![](<../../.gitbook/assets/image (576).png>)

* On a linux system, if you want to execute another process, it's called _forking_ a process. It executes another process for you.

## 6.10: Countermeasures

### Generations of Anti-Virus Software

* **First Generation**: simple scanners require a malware signature to identify the malware. It was limited to the detection of known malware.
* **Second Generation: heuristic scanners** use heuristic rules to search for probable malware instances. Another approach is integrity checker.
* **Third generation: activity traps**: memory-resident programs identifying malware by actions rather than its structure in an infected program
* **Forth generation: full-featured protection**: packages consisting of a variety of anti=virus techniques used in conjunction including scanning and activity trap components and access control capability.

### Generic Decryption (GD)

* It's essentially a **mini virtual machine**. Most malware will encrypt itself with a key such that a signature or heuristic scanner cannot detect it because it doesn't do anything until it's decrypted.
* GD tries to take software it hasn't otherwise verified and let it execute in a sandbox and wait to decrypt itself before it lets itself out on the system.
* It includes a CPU emulator and a virus signature scanner.

#### What does Malicious Software Do to Counter This?

* It'll recognize it's in a virtual machine.
* It won't decrypt its payload.

### Host-Based Behavior Blocking Software

* As software has been more sophisticated, the software has been moving to the _host_ level, not the server itself.
* This integrates with the OS of the host itself and monitors behavior in real-time.
* Let's monitor it and stop it before it does any damage.&#x20;
* **Limitations**: because malicious code must run on the target machine before all its behaviors can be identified, it has to cause harm before the _cat_ gets smarter. (Cat being blocking).

### (Network) Perimeter Scanning

#### Ingress Monitor

* Examines inbound traffic and things connecting to you.

#### Egress Monitor

* You're wondering where it's going.
* You can check if your network has been compromised and you're a part of the bot-net.

## 6.11: Summary/Homework

{% embed url="https://quizlet.com/613351992/cyber-security-princikples-and-practice-chapter-6-malicious-software-flash-cards/" %}
Flashcards Available Here
{% endembed %}

6.1 What are three broad mechanisms that malware can use to propagate?&#x20;

* Injection, exploits, and social engineering.

6.2 What are four broad categories of payloads that malware may carry?&#x20;

* DoS attacks
*

6.3 What characteristics of an advanced persistent threat give it that name?&#x20;

6.4 What are typical phases of operation of a virus or worm?&#x20;

6.5 What mechanisms can a virus use to conceal itself?&#x20;

6.6 What is the difference between machine executable and macro viruses?&#x20;

6.7 What means can a worm use to access remote systems to propagate?&#x20;

6.8 What is a “drive-by-download” and how does it differ from a worm?&#x20;

6.9 How does a Trojan enable malware to propagate? How common are Trojans on com-puter systems? Or on mobile platforms?&#x20;

6.10 What is a “logic bomb”?&#x20;

6.11 What is the difference between a backdoor, a bot, a keylogger, spyware, and a rootkit? Can they all be present in the same malware?&#x20;

6.12 What is the difference between a “phishing” attack and a “spear-phishing” attack, par-ticularly in terms of who the target may be?&#x20;

6.13 List some the different levels in a system that a rootkit may use.&#x20;

6.14 Describe some malware countermeasure elements.&#x20;

6.15 List three places malware mitigation mechanisms may be located.&#x20;

6.16 Briefly describe the four generations of anti-virus software.



## 6.11: Summary/Homework Conflicted Copy

> Questions from Computer Security: Principles and Practice, Global Edition, 4/e

1. What are three broad mechanisms that malware can use to propagate?
   1. Social Engineering
   2. Exploits
   3. Targeted attacks via viruses and worms.
2. What are four broad categories of payloads that malware may carry?
   1. Spyware
   2. Ransomware
   3. Remote Execution or Login
   4. Steal information
   5. Denial of Service
3. What characteristics of an advanced persistent threat give it that name?
4. What are typical phases of operation of a virus or worm?
5. What is a blended attack?
6. What is the difference between a worm and a zombie?
7. What does “fingerprinting” mean for network worms?
8. What is a “drive-by-download” and how does it differ from a worm?
9.  How does a Trojan enable malware to propagate? How common are Trojans on

    computer systems? Or on mobile platforms?
10. What is a “logic bomb”?
11. What is the difference between a backdoor, a bot, a keylogger, spyware, and a rootkit?

    Can they all be present in the same malware?
12. What is the difference between a “phishing” attack and a “spear-phishing” attack,

    particularly in terms of who the target may be?
13. What is a clickjacking vulnerability?
14. List a few characteristics to classify rootkits.
15. Briefly describe the elements of a GD scanner.
16. Describe some rootkit countermeasures.



## Works Cited

* Stallings, William, and Lawrie Brown. _Computer Security_. Available from: VitalSource Bookshelf, (3rd Edition). Pearson Education (US), 2014.
* Dr. Rusty Baldwin's Slides: Malware.

## Further Reading

* **Dark Reading**: what is happening in the cybersecurity side?
